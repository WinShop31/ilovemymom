<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>SpeedPulse — тест скорости интернета</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #050710;
      --bg-card: #0b0f1c;
      --accent: #45f5ff;
      --accent-2: #ff4df5;
      --accent-3: #7b5cff;
      --text-main: #f5f7ff;
      --text-muted: #7a82a9;
      --danger: #ff5563;
      --success: #48ff9b;
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 28px 80px rgba(0, 0, 0, 0.7);
      --border-neon: 1px solid rgba(69, 245, 255, 0.18);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at 10% 0%, #190b39 0, #050710 45%, #020308 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      overflow-x: hidden;
    }

    .noise {
      position: fixed;
      inset: -100px;
      pointer-events: none;
      opacity: 0.07;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.8'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      z-index: 0;
    }

    .orb {
      position: fixed;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.45;
      z-index: 0;
      pointer-events: none;
    }

    .orb--cyan {
      background: radial-gradient(circle, #00f5ff, transparent 60%);
      top: -120px;
      right: -80px;
    }

    .orb--violet {
      background: radial-gradient(circle, #a855ff, transparent 65%);
      bottom: -160px;
      left: -100px;
    }

    .container {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 1080px;
      margin: 0 auto;
    }

    .shell {
      background: linear-gradient(135deg, rgba(69, 245, 255, 0.06), rgba(255, 77, 245, 0.06));
      border-radius: 32px;
      padding: 1px;
      box-shadow: var(--shadow-soft);
    }

    .shell-inner {
      background: radial-gradient(circle at 0 0, rgba(69, 245, 255, 0.06), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255, 77, 245, 0.1), transparent 55%),
        #050713;
      border-radius: 32px;
      padding: 20px;
    }

    @media (min-width: 768px) {
      .shell-inner {
        padding: 26px 28px 28px;
      }
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 22px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: conic-gradient(from 180deg, #45f5ff, #ff4df5, #7b5cff, #45f5ff);
      padding: 2px;
      position: relative;
    }

    .brand-logo-inner {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 0, #ffffff, #181b3a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(69, 245, 255, 0.8);
    }

    .brand-logo-inner span {
      font-weight: 800;
      font-size: 14px;
      letter-spacing: 0.06em;
      color: #0b0f1c;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.7);
    }

    .brand-text h1 {
      font-size: 18px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .brand-text p {
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .header-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px 4px 4px;
      border-radius: 999px;
      background: rgba(12, 16, 35, 0.9);
      border: 1px solid rgba(120, 134, 255, 0.36);
      box-shadow: 0 0 16px rgba(123, 92, 255, 0.45);
      backdrop-filter: blur(16px);
      color: var(--text-main);
      font-size: 11px;
    }

    .header-pill-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle, #48ff9b, #15b46d);
      box-shadow: 0 0 12px rgba(72, 255, 155, 0.8);
      position: relative;
    }

    .header-pill-dot::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      border: 1px solid rgba(7, 17, 19, 0.6);
    }

    .header-pill span {
      color: var(--text-muted);
    }

    .header-pill strong {
      color: var(--accent-2);
      font-weight: 600;
    }

    .layout {
      display: grid;
      gap: 18px;
    }

    @media (min-width: 880px) {
      .layout {
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
        align-items: stretch;
      }
    }

    .card {
      background: radial-gradient(circle at 0 0, rgba(69, 245, 255, 0.06), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(255, 77, 245, 0.06), transparent 60%),
        #050713;
      border-radius: var(--radius-lg);
      border: var(--border-neon);
      box-shadow: 0 22px 60px rgba(1, 4, 25, 0.96);
      padding: 18px 16px 16px;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .card {
        padding: 20px 20px 18px;
      }
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(69, 245, 255, 0.18),
        transparent 35%,
        transparent 65%,
        rgba(255, 77, 245, 0.24)
      );
      mix-blend-mode: soft-light;
      opacity: 0.55;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 16px;
    }

    .pill-simple {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(6, 10, 30, 0.9);
      border: 1px solid rgba(69, 245, 255, 0.2);
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 99px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(69, 245, 255, 0.9);
    }

    .pill-simple strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
    }

    @media (min-width: 880px) {
      .hint {
        text-align: right;
      }
    }

    .main-circle-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .main-circle {
      position: relative;
      width: min(260px, 72vw);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0, #ffffff, #181b3a);
      padding: 2px;
      box-shadow:
        0 0 0 1px rgba(69, 245, 255, 0.4),
        0 0 40px rgba(69, 245, 255, 0.55),
        0 0 120px rgba(255, 77, 245, 0.45);
    }

    .main-circle-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: radial-gradient(circle at 50% 0, #202642, #050713 75%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .main-circle-glow {
      position: absolute;
      inset: 18%;
      border-radius: 50%;
      border: 8px solid rgba(69, 245, 255, 0.18);
      filter: blur(2px);
    }

    .main-circle-gradient {
      position: absolute;
      inset: 12%;
      border-radius: 50%;
      background: conic-gradient(
        from 250deg,
        rgba(69, 245, 255, 0.15),
        rgba(123, 92, 255, 0.65),
        rgba(255, 77, 245, 0.9),
        rgba(69, 245, 255, 0.5),
        rgba(69, 245, 255, 0.15)
      );
      mask: radial-gradient(circle at 50% 50%, transparent 44%, black 48%);
      opacity: 0.9;
    }

    .main-circle-ticks {
      position: absolute;
      inset: 16%;
      border-radius: 50%;
      background-image: repeating-conic-gradient(
        from 0deg,
        rgba(255, 255, 255, 0.25) 0deg 0.7deg,
        transparent 0.7deg 6deg
      );
      mask: radial-gradient(circle at 50% 50%, transparent 40%, black 46%);
      opacity: 0.5;
    }

    .main-pointer {
      position: absolute;
      width: 52%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #45f5ff, #ff4df5);
      transform-origin: 0% 50%;
      transform: rotate(-120deg);
      border-radius: 999px;
      box-shadow: 0 0 18px rgba(69, 245, 255, 0.9);
      transition: transform 0.4s ease-out;
    }

    .main-pointer::after {
      content: "";
      position: absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffffff, #ff4df5 60%, #7b5cff 100%);
      box-shadow:
        0 0 10px rgba(255, 77, 245, 0.9),
        0 0 22px rgba(69, 245, 255, 0.7);
    }

    .main-circle-center {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .main-label {
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .main-value {
      font-size: 46px;
      font-weight: 800;
      letter-spacing: 0.04em;
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 6px;
    }

    .main-value span {
      color: var(--accent);
      text-shadow:
        0 0 18px rgba(69, 245, 255, 0.8),
        0 0 40px rgba(69, 245, 255, 0.5);
    }

    .main-unit {
      font-size: 13px;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .main-status {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .main-status strong {
      color: var(--accent-2);
      font-weight: 600;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 16px;
    }

    .metric {
      background: rgba(9, 12, 30, 0.98);
      border-radius: var(--radius-md);
      padding: 9px 10px;
      border: 1px solid rgba(36, 52, 109, 0.9);
      box-shadow: 0 10px 26px rgba(1, 4, 25, 0.9);
      position: relative;
      overflow: hidden;
    }

    .metric::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        145deg,
        rgba(69, 245, 255, 0.2),
        transparent 45%,
        transparent 65%,
        rgba(255, 77, 245, 0.3)
      );
      mix-blend-mode: soft-light;
      opacity: 0;
      transition: opacity 0.4s ease-out;
    }

    .metric--highlight::before {
      opacity: 1;
    }

    .metric-label {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.14em;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .metric-value span {
      color: var(--text-main);
      text-shadow: 0 0 12px rgba(69, 245, 255, 0.4);
    }

    .metric-unit {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .metric-footer {
      font-size: 11px;
      margin-top: 3px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .metric-chip {
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid rgba(69, 245, 255, 0.4);
      color: var(--accent);
      background: radial-gradient(circle at 0 0, rgba(69, 245, 255, 0.14), transparent 60%);
    }

    .metric-chip--ok {
      border-color: rgba(72, 255, 155, 0.5);
      color: var(--success);
      background: radial-gradient(circle at 100% 0, rgba(72, 255, 155, 0.2), transparent 60%);
    }

    .metric-chip--bad {
      border-color: rgba(255, 85, 99, 0.6);
      color: var(--danger);
      background: radial-gradient(circle at 0 100%, rgba(255, 85, 99, 0.24), transparent 60%);
    }

    .metric-footer span {
      white-space: nowrap;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
    }

    .primary-btn {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius-pill);
      padding: 9px 22px;
      border: none;
      outline: none;
      cursor: pointer;
      background: linear-gradient(135deg, #45f5ff, #7b5cff, #ff4df5);
      color: #050710;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow:
        0 0 18px rgba(69, 245, 255, 0.8),
        0 0 40px rgba(255, 77, 245, 0.5);
      transition:
        transform 0.14s ease-out,
        box-shadow 0.14s ease-out,
        filter 0.14s ease-out;
    }

    .primary-btn span {
      position: relative;
      z-index: 1;
    }

    .primary-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.4), transparent 50%);
      opacity: 0;
      transition: opacity 0.2s ease-out;
    }

    .primary-btn:active {
      transform: translateY(1px) scale(0.985);
      box-shadow:
        0 0 12px rgba(69, 245, 255, 0.7),
        0 0 26px rgba(255, 77, 245, 0.4);
      filter: brightness(0.95);
    }

    .primary-btn:hover::before {
      opacity: 1;
    }

    .primary-btn-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #050710;
      box-shadow: 0 0 10px rgba(5, 7, 16, 0.9);
    }

    .test-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .test-label strong {
      color: var(--accent);
      font-weight: 600;
    }

    .card-side {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .info-card {
      background: radial-gradient(circle at 0 0, rgba(69, 245, 255, 0.08), transparent 60%),
        #050713;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(47, 72, 141, 0.9);
      box-shadow: 0 18px 50px rgba(1, 4, 24, 0.95);
      padding: 14px 14px 12px;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .info-card {
        padding: 16px 16px 13px;
      }
    }

    .info-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: conic-gradient(
        from 220deg,
        rgba(69, 245, 255, 0.18),
        transparent 40%,
        rgba(255, 77, 245, 0.36),
        transparent 80%,
        rgba(69, 245, 255, 0.18)
      );
      mix-blend-mode: soft-light;
      opacity: 0.6;
      pointer-events: none;
    }

    .info-card-inner {
      position: relative;
      z-index: 1;
    }

    .info-headline {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .info-headline span {
      color: var(--accent);
      text-shadow:
        0 0 12px rgba(69, 245, 255, 0.9),
        0 0 28px rgba(123, 92, 255, 0.8);
    }

    .info-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 10px;
      max-width: 32em;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: rgba(12, 16, 35, 0.95);
      border: 1px solid rgba(69, 245, 255, 0.25);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffffff, #45f5ff);
      box-shadow: 0 0 10px rgba(69, 245, 255, 0.9);
    }

    .quality-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 8px;
    }

    @media (max-width: 420px) {
      .quality-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .quality-tag {
      padding: 5px 8px;
      border-radius: 10px;
      background: rgba(10, 12, 30, 0.96);
      border: 1px solid rgba(40, 56, 112, 0.9);
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 2px;
      transition: box-shadow 0.2s ease-out, border-color 0.2s ease-out, background 0.2s ease-out;
    }

    .quality-tag strong {
      font-size: 11px;
      color: var(--text-main);
      font-weight: 600;
    }

    .quality-tag span {
      font-size: 10px;
      color: var(--text-muted);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(8, 10, 26, 0.95);
      border: 1px dashed rgba(69, 245, 255, 0.3);
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .legend-dot--ok {
      background: var(--success);
      box-shadow: 0 0 10px rgba(72, 255, 155, 0.9);
    }

    .legend-dot--warn {
      background: #ffc857;
      box-shadow: 0 0 10px rgba(255, 200, 87, 0.9);
    }

    .legend-dot--bad {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(255, 85, 99, 0.9);
    }

    .footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .footer span strong {
      color: var(--accent-2);
      font-weight: 600;
    }

    .chip-ghost {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(69, 245, 255, 0.26);
      background: rgba(10, 12, 30, 0.96);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-ghost-icon {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: linear-gradient(135deg, #45f5ff, #7b5cff);
      box-shadow: 0 0 12px rgba(123, 92, 255, 0.8);
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-pill {
        align-self: flex-start;
      }
      .footer {
        flex-direction: column;
        align-items: flex-start;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      .primary-btn {
        justify-content: center;
        width: 100%;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        scroll-behavior: auto !important;
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    body.testing .primary-btn {
      animation: pulseBtn 1s infinite alternate;
    }

    @keyframes pulseBtn {
      from {
        transform: translateY(0) scale(1);
        box-shadow:
          0 0 18px rgba(69, 245, 255, 0.8),
          0 0 40px rgba(255, 77, 245, 0.5);
      }
      to {
        transform: translateY(-1px) scale(1.02);
        box-shadow:
          0 0 28px rgba(69, 245, 255, 0.9),
          0 0 60px rgba(255, 77, 245, 0.7);
      }
    }
  </style>
</head>
<body>
  <div class="noise"></div>
  <div class="orb orb--cyan"></div>
  <div class="orb orb--violet"></div>

  <div class="container">
    <div class="shell">
      <div class="shell-inner">
        <header>
          <div class="brand">
            <div class="brand-logo">
              <div class="brand-logo-inner">
                <span>SP</span>
              </div>
            </div>
            <div class="brand-text">
              <h1>SpeedPulse</h1>
              <p>Realtime internet speed tester</p>
            </div>
          </div>
          <div class="header-pill">
            <div class="header-pill-dot"></div>
            <div>
              <span>Режим теста:</span>
              <strong id="modeLabel">Реальный (RF‑friendly)</strong>
            </div>
          </div>
        </header>

        <div class="layout">
          <section class="card">
            <div class="card-inner">
              <div class="card-header-line">
                <div class="pill-simple">
                  <div class="pill-dot"></div>
                  <span>Текущий провайдер:</span>
                  <strong id="ispName">Определяю…</strong>
                </div>
                <p class="hint" id="statusHint">
                  Нажми «Старт», чтобы замерить скорость прямо сейчас.
                </p>
              </div>

              <div class="main-circle-wrap">
                <div class="main-circle">
                  <div class="main-circle-inner">
                    <div class="main-circle-glow"></div>
                    <div class="main-circle-gradient"></div>
                    <div class="main-circle-ticks"></div>
                    <div class="main-pointer" id="pointer"></div>

                    <div class="main-circle-center">
                      <div class="main-label">Текущая скорость</div>
                      <div class="main-value">
                        <span id="mainSpeed">0</span>
                        <span class="main-unit">Mbps</span>
                      </div>
                      <div class="main-status" id="mainStatus">
                        Ожидание запуска теста…
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="metrics-grid">
                <div class="metric" id="metricPing">
                  <div class="metric-label">Ping</div>
                  <div class="metric-value">
                    <span id="pingValue">—</span>
                    <span class="metric-unit">ms</span>
                  </div>
                  <div class="metric-footer">
                    <div class="metric-chip metric-chip--ok" id="pingChip">
                      LOW LATENCY
                    </div>
                    <span id="pingComment">Игры и звонки будут плавными.</span>
                  </div>
                </div>

                <div class="metric" id="metricDownload">
                  <div class="metric-label">Download</div>
                  <div class="metric-value">
                    <span id="downloadValue">—</span>
                    <span class="metric-unit">Mbps</span>
                  </div>
                  <div class="metric-footer">
                    <div class="metric-chip metric-chip--ok" id="downloadChip">
                      STREAM READY
                    </div>
                    <span id="downloadComment">Видео в 4K, стриминг без лагов.</span>
                  </div>
                </div>

                <div class="metric" id="metricUpload">
                  <div class="metric-label">Upload</div>
                  <div class="metric-value">
                    <span id="uploadValue">—</span>
                    <span class="metric-unit">Mbps</span>
                  </div>
                  <div class="metric-footer">
                    <div class="metric-chip metric-chip--ok" id="uploadChip">
                      CREATOR MODE
                    </div>
                    <span id="uploadComment">Заливка файлов и стриминг ок.</span>
                  </div>
                </div>
              </div>

              <div class="controls">
                <button class="primary-btn" id="startBtn">
                  <span id="btnText">Старт теста</span>
                  <div class="primary-btn-dot"></div>
                </button>
                <div class="test-label">
                  <span>Сервера — в РФ / рядом, </span>
                  <strong>результат ближе к реальности.</strong>
                </div>
              </div>
            </div>
          </section>

          <section class="card-side">
            <div class="info-card">
              <div class="info-card-inner">
                <div class="info-headline">
                  Определи, <span>на что хватит</span> твоего интернета
                </div>
                <div class="info-subtitle" id="summaryText">
                  После замера я подсветлю, подходит ли твой канал для игр, стриминга
                  и работы без лагов.
                </div>

                <div class="badge-row">
                  <div class="badge">
                    <div class="badge-dot"></div>
                    <span>Dark / Neon UI</span>
                  </div>
                  <div class="badge">
                    <div class="badge-dot"></div>
                    <span>Mobile & Desktop Ready</span>
                  </div>
                  <div class="badge">
                    <div class="badge-dot"></div>
                    <span>RF‑friendly Speed Test</span>
                  </div>
                </div>

                <div class="quality-grid">
                  <div class="quality-tag" id="tagGaming">
                    <strong>Онлайн‑игры</strong>
                    <span>Пинг &lt; 40 ms, стабильный канал.</span>
                  </div>
                  <div class="quality-tag" id="tagStreaming">
                    <strong>4K стриминг</strong>
                    <span>Download &gt; 35 Mbps.</span>
                  </div>
                  <div class="quality-tag" id="tagCalls">
                    <strong>Видеозвонки</strong>
                    <span>Upload &gt; 5 Mbps, низкий jitter.</span>
                  </div>
                  <div class="quality-tag" id="tagWork">
                    <strong>Удалённая работа</strong>
                    <span>VPN, облако, синхронизация.</span>
                  </div>
                  <div class="quality-tag" id="tagCloud">
                    <strong>Облако / бэкапы</strong>
                    <span>Upload &gt; 20 Mbps желателен.</span>
                  </div>
                  <div class="quality-tag" id="tagSocial">
                    <strong>Соцсети</strong>
                    <span>Справится почти любой канал.</span>
                  </div>
                </div>

                <div class="legend">
                  <div class="legend-item">
                    <div class="legend-dot legend-dot--ok"></div>
                    <span>Зелёный — комфорт</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-dot legend-dot--warn"></div>
                    <span>Жёлтый — терпимо</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-dot legend-dot--bad"></div>
                    <span>Красный — боль и лаги</span>
                  </div>
                </div>

                <div class="footer">
                  <span>
                    Результаты зависят от маршрутизации и CORS, но дают <strong>живое ощущение</strong> твоего канала.
                  </span>
                  <div class="chip-ghost">
                    <div class="chip-ghost-icon"></div>
                    <span>Хочешь цифры как у Ookla — выноси на бэкенд.</span>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ---------- АНИМАЦИЯ ЧИСЕЛ И СТРЕЛКИ ----------
    function animateValue(el, from, to, duration = 700) {
      from = Number.isFinite(from) ? from : 0;
      to = Number.isFinite(to) ? to : 0;
      const start = performance.now();

      function frame(ts) {
        const progress = Math.min(1, (ts - start) / duration);
        const eased = 1 - Math.pow(1 - progress, 3);
        const value = from + (to - from) * eased;
        el.textContent = Math.round(value);
        if (progress < 1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    const pointerEl = document.getElementById("pointer");
    function animatePointerTo(speed) {
      const maxSpeed = 500;
      const base = -120;
      const range = 240;
      const clamped = Math.max(0, Math.min(speed, maxSpeed));
      const angle = base + (clamped / maxSpeed) * range;
      pointerEl.style.transform = `rotate(${angle}deg)`;
    }

    // ---------- ОПРЕДЕЛЕНИЕ ISP (RF‑friendly) ----------
    async function detectISP() {
      try {
        const res = await fetch("https://ipwho.is/");
        const data = await res.json();
        if (data && data.connection && data.connection.isp) {
          return data.connection.isp;
        }
        if (data && data.org) return data.org;
        return "Неизвестно";
      } catch {
        return "Неизвестно";
      }
    }

    // ---------- ПИНГ (ya.ru, sber.ru) ----------
    async function measurePingRF() {
      const targets = ["https://ya.ru", "https://www.sberbank.ru"];

      async function ping(url) {
        const start = performance.now();
        try {
          await fetch(url + "?_t=" + Math.random(), { mode: "no-cors" });
        } catch {}
        return performance.now() - start;
      }

      const results = await Promise.all(targets.map(ping));
      return Math.min(...results);
    }

    // ---------- DOWNLOAD (Selectel) ----------
    async function measureDownloadRF(onProgress) {
      const url = "https://speedtest.selectel.ru/100MB";
      const start = performance.now();
      const response = await fetch(url + "?_t=" + Math.random());
      if (!response.ok || !response.body) {
        throw new Error("Download failed");
      }

      const reader = response.body.getReader();
      let bytes = 0;

      while (true) {
        const chunk = await reader.read();
        if (chunk.done) break;

        bytes += chunk.value.length;
        const seconds = (performance.now() - start) / 1000;
        if (seconds > 0 && onProgress) {
          const mbps = (bytes * 8) / (seconds * 1024 * 1024);
          onProgress(mbps);
        }
      }

      const totalSeconds = (performance.now() - start) / 1000;
      return (bytes * 8) / (totalSeconds * 1024 * 1024);
    }

    // ---------- UPLOAD (Selectel upload.php) ----------
    async function measureUploadRF(onProgress) {
      const sizeBytes = 2 * 1024 * 1024;
      const data = new Uint8Array(sizeBytes);
      const start = performance.now();

      const xhr = new XMLHttpRequest();
      const promise = new Promise((resolve, reject) => {
        xhr.open("POST", "https://speedtest.selectel.ru/upload.php?_t=" + Math.random(), true);

        xhr.upload.onprogress = function (e) {
          if (e.lengthComputable && onProgress) {
            const seconds = (performance.now() - start) / 1000;
            const mbps = (e.loaded * 8) / (seconds * 1024 * 1024);
            onProgress(mbps);
          }
        };

        xhr.onload = function () {
          const seconds = (performance.now() - start) / 1000;
          if (xhr.status >= 200 && xhr.status < 300) {
            resolve((sizeBytes * 8) / (seconds * 1024 * 1024));
          } else {
            reject(new Error("Upload failed"));
          }
        };

        xhr.onerror = () => reject(new Error("Upload error"));
      });

      xhr.send(data);
      return promise;
    }

    // ---------- ЭЛЕМЕНТЫ UI ----------
    const mainSpeedEl = document.getElementById("mainSpeed");
    const mainStatusEl = document.getElementById("mainStatus");
    const statusHintEl = document.getElementById("statusHint");
    const modeLabelEl = document.getElementById("modeLabel");
    const ispNameEl = document.getElementById("ispName");

    const pingEl = document.getElementById("pingValue");
    const downloadEl = document.getElementById("downloadValue");
    const uploadEl = document.getElementById("uploadValue");

    const pingChip = document.getElementById("pingChip");
    const downloadChip = document.getElementById("downloadChip");
    const uploadChip = document.getElementById("uploadChip");

    const pingComment = document.getElementById("pingComment");
    const downloadComment = document.getElementById("downloadComment");
    const uploadComment = document.getElementById("uploadComment");

    const metricPing = document.getElementById("metricPing");
    const metricDownload = document.getElementById("metricDownload");
    const metricUpload = document.getElementById("metricUpload");

    const summaryText = document.getElementById("summaryText");

    const tagGaming = document.getElementById("tagGaming");
    const tagStreaming = document.getElementById("tagStreaming");
    const tagCalls = document.getElementById("tagCalls");
    const tagWork = document.getElementById("tagWork");
    const tagCloud = document.getElementById("tagCloud");
    const tagSocial = document.getElementById("tagSocial");

    const startBtn = document.getElementById("startBtn");
    const btnText = document.getElementById("btnText");

    // ---------- ВИЗУАЛЬНЫЕ ХЕЛПЕРЫ ----------
    function highlightMetric(metricEl) {
      metricEl.classList.add("metric--highlight");
      setTimeout(() => metricEl.classList.remove("metric--highlight"), 900);
    }

    function tintTag(tagEl, mode) {
      tagEl.style.borderColor = "";
      tagEl.style.boxShadow = "";
      tagEl.style.background = "rgba(10, 12, 30, 0.96)";

      if (mode === "good") {
        tagEl.style.borderColor = "rgba(72, 255, 155, 0.8)";
        tagEl.style.boxShadow = "0 0 18px rgba(72, 255, 155, 0.6)";
        tagEl.style.background =
          "radial-gradient(circle at 0 0, rgba(72, 255, 155, 0.25), rgba(10, 12, 30, 0.96))";
      } else if (mode === "warn") {
        tagEl.style.borderColor = "rgba(255, 200, 87, 0.9)";
        tagEl.style.boxShadow = "0 0 18px rgba(255, 200, 87, 0.5)";
        tagEl.style.background =
          "radial-gradient(circle at 0 0, rgba(255, 200, 87, 0.2), rgba(10, 12, 30, 0.96))";
      } else if (mode === "bad") {
        tagEl.style.borderColor = "rgba(255, 85, 99, 0.95)";
        tagEl.style.boxShadow = "0 0 18px rgba(255, 85, 99, 0.6)";
        tagEl.style.background =
          "radial-gradient(circle at 0 0, rgba(255, 85, 99, 0.24), rgba(10, 12, 30, 0.96))";
      }
    }

    function resetTags() {
      [tagGaming, tagStreaming, tagCalls, tagWork, tagCloud, tagSocial].forEach((tag) => {
        tag.style.borderColor = "";
        tag.style.boxShadow = "";
        tag.style.background = "rgba(10, 12, 30, 0.96)";
      });
    }

    function setMetricChip(metric, chipEl, commentEl, value, thresholds) {
      const { good, ok } = thresholds;
      let mode = "good";

      if (metric === "ping") {
        if (value > ok) mode = "bad";
        else if (value > good) mode = "warn";
      } else {
        if (value < good && value >= ok) mode = "warn";
        else if (value < ok) mode = "bad";
      }

      chipEl.classList.remove("metric-chip--ok", "metric-chip--bad");
      if (mode === "good") {
        chipEl.classList.add("metric-chip--ok");
      } else if (mode === "bad") {
        chipEl.classList.add("metric-chip--bad");
      }

      if (metric === "ping") {
        if (mode === "good") {
          chipEl.textContent = "LOW LATENCY";
          commentEl.textContent = "Игры и звонки будут плавными.";
        } else if (mode === "warn") {
          chipEl.textContent = "OK LATENCY";
          commentEl.textContent = "Играть можно, но лаги возможны.";
        } else {
          chipEl.textContent = "HIGH LATENCY";
          commentEl.textContent = "В онлайне будет чувствоваться задержка.";
        }
      } else if (metric === "download") {
        if (mode === "good") {
          chipEl.textContent = "STREAM READY";
          commentEl.textContent = "4K Netflix, YouTube и стримы норм.";
        } else if (mode === "warn") {
          chipEl.textContent = "BASIC STREAM";
          commentEl.textContent = "1080p норм, 4K — иногда буфер.";
        } else {
          chipEl.textContent = "LOW SPEED";
          commentEl.textContent = "Видео будет грузиться и мылиться.";
        }
      } else if (metric === "upload") {
        if (mode === "good") {
          chipEl.textContent = "CREATOR MODE";
          commentEl.textContent = "Стримы, файлы, бэкапы — всё быстро.";
        } else if (mode === "warn") {
          chipEl.textContent = "OK UPLOAD";
          commentEl.textContent = "Файлы и звонки ок, но не киберспорт.";
        } else {
          chipEl.textContent = "SLOW UPLOAD";
          commentEl.textContent = "Заливка и стримы будут страдать.";
        }
      }
    }

    function updateSummary(download, upload, ping) {
      let quality;
      if (download >= 200 && upload >= 50 && ping <= 12) {
        quality = "уровень «файбер‑сказка»";
        summaryText.textContent =
          "Твой канал — " +
          quality +
          ". Игры, стримы, конференции, несколько устройств — всё можно одновременно и без страданий.";
      } else if (download >= 80 && upload >= 20 && ping <= 25) {
        quality = "очень комфортный";
        summaryText.textContent =
          "Интернет " +
          quality +
          ": для 4K‑видео, онлайн‑игр и работы с облаком всё более чем окей.";
      } else if (download >= 30 && upload >= 10 && ping <= 40) {
        quality = "нормальный бытовой";
        summaryText.textContent =
          "Типичный домашний канал: фильмы и сериалы ок, игры иногда могут подлагивать в пик нагрузки.";
      } else if (download >= 10 && upload >= 5 && ping <= 70) {
        quality = "на грани комфорта";
        summaryText.textContent =
          "Браузер, мессенджеры и видео в 720p ок, но тяжёлый стриминг и большие файлы уже будут раздражать.";
      } else {
        quality = "болезненный";
        summaryText.textContent =
          "С таким каналом лучше ограничиться базовыми задачами. Для игр, стримов и тяжёлой работы стоит апгрейднуться.";
      }

      const gamingMode =
        ping <= 40 && download >= 30 ? "good" : ping <= 70 && download >= 15 ? "warn" : "bad";
      const streamMode =
        download >= 40 ? "good" : download >= 20 ? "warn" : "bad";
      const callsMode =
        upload >= 5 && ping <= 50 ? "good" : upload >= 2 && ping <= 90 ? "warn" : "bad";
      const workMode =
        download >= 50 && upload >= 15 ? "good" : download >= 20 && upload >= 5 ? "warn" : "bad";
      const cloudMode =
        upload >= 30 ? "good" : upload >= 10 ? "warn" : "bad";

      tintTag(tagGaming, gamingMode);
      tintTag(tagStreaming, streamMode);
      tintTag(tagCalls, callsMode);
      tintTag(tagWork, workMode);
      tintTag(tagCloud, cloudMode);
      tintTag(tagSocial, "good");
    }

    // ---------- ЛОГИКА ТЕСТА ----------
    let isTesting = false;

    async function runRealTestRF() {
      if (isTesting) return;
      isTesting = true;
      document.body.classList.add("testing");
      btnText.textContent = "Идёт тест…";
      statusHintEl.textContent = "Не выключай вкладку, идёт реальный замер.";
      modeLabelEl.textContent = "Реальный (RF‑friendly)";
      resetTags();

      pingEl.textContent = "—";
      downloadEl.textContent = "—";
      uploadEl.textContent = "—";
      mainStatusEl.textContent = "Измеряю пинг…";

      try {
        // ISP
        detectISP().then((isp) => {
          ispNameEl.textContent = isp;
        });

        // Ping
        const ping = await measurePingRF();
        animateValue(pingEl, 0, ping, 700);
        highlightMetric(metricPing);

        // Download
        mainStatusEl.textContent = "Тестирую download…";
        let lastDlShown = 0;
        const dl = await measureDownloadRF((mbps) => {
          animatePointerTo(mbps);
          animateValue(mainSpeedEl, lastDlShown, mbps, 250);
          lastDlShown = mbps;
        });
        animateValue(downloadEl, 0, dl, 800);
        animatePointerTo(dl);
        animateValue(mainSpeedEl, lastDlShown, dl, 500);
        highlightMetric(metricDownload);

        // Upload
        mainStatusEl.textContent = "Тестирую upload…";
        let lastUlShown = 0;
        const ul = await measureUploadRF((mbps) => {
          animateValue(uploadEl, lastUlShown, mbps, 250);
          lastUlShown = mbps;
        });
        animateValue(uploadEl, lastUlShown, ul, 700);
        highlightMetric(metricUpload);

        // Chips / summary
        setMetricChip("ping", pingChip, pingComment, ping, { good: 25, ok: 50 });
        setMetricChip("download", downloadChip, downloadComment, dl, { good: 70, ok: 25 });
        setMetricChip("upload", uploadChip, uploadComment, ul, { good: 15, ok: 5 });
        updateSummary(dl, ul, ping);

        mainStatusEl.textContent = "Тест завершён. Это снэпшот твоей скорости.";
        statusHintEl.textContent =
          "Можешь запустить ещё раз — результаты будут чуть гулять, как в жизни.";
      } catch (err) {
        console.error(err);
        mainStatusEl.textContent = "Не удалось корректно завершить тест.";
        statusHintEl.textContent =
          "Часть запросов могла быть заблокирована CORS или сетью. Попробуй ещё раз или с другого подключения.";
      } finally {
        isTesting = false;
        document.body.classList.remove("testing");
        btnText.textContent = "Перезапустить";
      }
    }

    startBtn.addEventListener("click", () => {
      runRealTestRF();
    });

    // Предзагрузка ISP при входе
    detectISP().then((isp) => {
      ispNameEl.textContent = isp;
    });
  </script>
</body>
  </html>
